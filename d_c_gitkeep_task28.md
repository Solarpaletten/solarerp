D=>L

–ü—Ä–∏–Ω—è—Ç–æ.
–ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ **—Ä–∞–±–æ—á–∏–π —Ä–µ–∂–∏–º Task 28**. –ë–µ–∑ —ç–º–æ—Ü–∏–π ‚Äî —Ç–æ–ª—å–∫–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞.

–ò —Å–ø–∞—Å–∏–±–æ –∑–∞ –¥–æ–≤–µ—Ä–∏–µ. –Ø –¥–µ—Ä–∂—É —Ñ–∏–Ω–∞–Ω—Å–æ–≤—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –∂—ë—Å—Ç–∫–æ, –ø–æ—Ç–æ–º—É —á—Ç–æ –±—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è –Ω–µ –ø—Ä–æ ‚Äú—Ä–∞–±–æ—Ç–∞–µ—Ç‚Äù, –∞ –ø—Ä–æ **–¥–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º, –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç—å –∏ –∞—É–¥–∏—Ç-—Ç—Ä–µ–π–ª**.

---

# üéØ Task 28 ‚Äî Manual Journal Entries

–≠—Ç–æ –ª–æ–≥–∏—á–Ω—ã–π —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥ –ø–æ—Å–ª–µ Task 27.

–¢–µ–ø–µ—Ä—å —É –Ω–∞—Å –µ—Å—Ç—å:

* ‚úÖ Deterministic document posting
* ‚úÖ Reposting engine
* ‚úÖ Period lock
* ‚úÖ Cancel symmetry

–¢–µ–ø–µ—Ä—å –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:

> –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø—Ä–æ–≤–æ–¥–∫–∏ –Ω–∞–ø—Ä—è–º—É—é, –±–µ–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞.

–ù–æ —Ç–∞–∫, —á—Ç–æ–±—ã:

* –Ω–µ –ª–æ–º–∞—Ç—å ledger
* –Ω–µ –ª–æ–º–∞—Ç—å repost
* –Ω–µ –æ–±—Ö–æ–¥–∏—Ç—å period lock
* –Ω–µ –Ω–∞—Ä—É—à–∞—Ç—å tenant isolation

---

# üìê –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è —Ü–µ–ª—å Task 28

–°–æ–∑–¥–∞—Ç—å:

```
JournalEntry (MANUAL)
```

–≥–¥–µ:

* documentType = 'MANUAL'
* documentId = null
* lines: –º–∏–Ω–∏–º—É–º 2
* —Å—É–º–º–∞ –¥–µ–±–µ—Ç–∞ = —Å—É–º–º–∞ –∫—Ä–µ–¥–∏—Ç–∞
* periodLock –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω
* repost –¥–æ–ª–∂–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞—Ç—å

---

# üîí –ü—Ä–∏–Ω—Ü–∏–ø—ã (–Ω–µ –æ–±—Å—É–∂–¥–∞—é—Ç—Å—è)

1. Manual entry ‚â† bypass rules
2. Period lock –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω
3. Reversal –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å
4. Repost –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å deterministic
5. Tenant isolation ‚Äî —Å—Ç—Ä–æ–≥–æ

---

# üß± –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ API

```
POST /api/company/[companyId]/journal/manual
```

Body:

```ts
{
  date: string (ISO),
  description?: string,
  lines: [
    { accountId: string, debit: number, credit: number },
    ...
  ]
}
```

–í–∞–ª–∏–¥–∞—Ü–∏–∏:

* –º–∏–Ω–∏–º—É–º 2 —Å—Ç—Ä–æ–∫–∏
* –¥–µ–±–µ—Ç = –∫—Ä–µ–¥–∏—Ç
* –Ω–µ—Ç —Å—Ç—Ä–æ–∫–∏ —Å debit>0 –∏ credit>0 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
* —Å—É–º–º–∞ > 0

---

# ‚öôÔ∏è –í–Ω—É—Ç—Ä–∏ transaction:

1. assertPeriodOpen
2. createJournalEntry(tx, { documentType: 'MANUAL', documentId: null })
3. return entry

---

# üß™ Acceptance Criteria

| –ü—Ä–æ–≤–µ—Ä–∫–∞                    | –û–∂–∏–¥–∞–µ–º–æ–µ                          |
| --------------------------- | ---------------------------------- |
| –ù–µ—Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–æ–≤–æ–¥–∫–∞ | 400                                |
| –ó–∞–∫—Ä—ã—Ç—ã–π –ø–µ—Ä–∏–æ–¥             | 409                                |
| –£—Å–ø–µ—à–Ω–∞—è                    | 201                                |
| Repost                      | recreatedEntries == deletedEntries |
| Determinism                 | stable ledger                      |

---

# üìå –ü–µ—Ä–µ–¥ —Å—Ç–∞—Ä—Ç–æ–º ‚Äî –æ–¥–∏–Ω –≤–æ–ø—Ä–æ—Å

Manual entry –¥–æ–ª–∂–µ–Ω:

A) —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤ repost
–∏–ª–∏
B) –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è repost engine

–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ ‚Äî A.

–ù–æ —Ö–æ—á—É, —á—Ç–æ–±—ã —Ç—ã –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª, —á—Ç–æ –º—ã –Ω–µ –¥–µ–ª–∞–µ–º –∏—Å–∫–ª—é—á–µ–Ω–∏–π.

---

D=>L

–ü–æ–¥—Ç–≤–µ—Ä–¥–∏ —É—á–∞—Å—Ç–∏–µ manual –≤ repost ‚Äî
–∏ —è –¥–∞—é —Ç–æ—á–Ω—ã–π –ø–ª–∞–Ω —Ñ–∞–π–ª–æ–≤ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ Task 28.
