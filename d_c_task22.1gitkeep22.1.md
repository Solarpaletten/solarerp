–û—Ç–ª–∏—á–Ω–æ.
–§–æ—Ä–º–∏—Ä—É—é **–∂—ë—Å—Ç–∫–æ–µ –¢–ó –¥–ª—è Claude (Task 22 Audit & Hardening)**.
–ë–µ–∑ —ç–º–æ—Ü–∏–π. –¢–æ–ª—å–∫–æ –∏–Ω–∂–µ–Ω–µ—Ä–Ω–∞—è –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞.

---

# D=>C

## Task 22.1 ‚Äî Ledger Hardening Audit

Claude,

–ø–µ—Ä–µ—Ö–æ–¥–∏–º –∏–∑ ‚Äú—Ä–∞–±–æ—Ç–∞–µ—Ç‚Äù –≤ ‚Äú–±–µ–∑–æ–ø–∞—Å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç‚Äù.

–û—Ç–≤–µ—Ç—å –ø–æ –∫–∞–∂–¥–æ–º—É –ø—É–Ω–∫—Ç—É **–∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ –ø–æ –∫–æ–¥—É**, –Ω–µ —Å–ª–æ–≤–∞–º–∏.

---

## üî¥ 1. Double-Entry Balance Guarantee (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ

–ü–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º `JournalEntry` –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:

```ts
sum(debit) === sum(credit)
```

–° –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º:

```
Prisma.Decimal
```

### –¢—ã –¥–æ–ª–∂–µ–Ω –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å:

1. –ì–¥–µ –∏–º–µ–Ω–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –±–∞–ª–∞–Ω—Å?
2. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏ Prisma.Decimal?
3. –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –Ω–µ–±–∞–ª–∞–Ω—Å–µ?

–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:

```ts
throw new Error("Journal entry not balanced")
```

–ò —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç—Å—è.

---

## üî¥ 2. Prisma Transaction Integrity

–°–æ–∑–¥–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å—Ç—Ä–æ–≥–æ:

```ts
await prisma.$transaction(async (tx) => {
  create document
  create journal entry
  create journal lines
})
```

### –û—Ç–≤–µ—Ç—å:

* –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `$transaction`?
* –ï—Å—Ç—å –ª–∏ —Å—Ü–µ–Ω–∞—Ä–∏–π, –≥–¥–µ document —Å–æ–∑–¥–∞—ë—Ç—Å—è –≤–Ω–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏?
* –ï—Å—Ç—å –ª–∏ try/catch, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –ø—Ä–æ–≥–ª–æ—Ç–∏—Ç—å –æ—à–∏–±–∫—É?

–ï—Å–ª–∏ —Ö–æ—Ç—å –æ–¥–∏–Ω document —Å–æ–∑–¥–∞—ë—Ç—Å—è –≤–Ω–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ ‚Äî —ç—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞.

---

## üî¥ 3. Document Editing / Deletion Strategy

–≠—Ç–æ —Å–µ–π—á–∞—Å —Å–∞–º–∞—è –æ–ø–∞—Å–Ω–∞—è –∑–æ–Ω–∞.

–û—Ç–≤–µ—Ç—å:

### –ï—Å–ª–∏:

* –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª—è–µ—Ç SaleDocument
  ‚Üí —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å JournalEntry?

### –ï—Å–ª–∏:

* –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–∑–º–µ–Ω—è–µ—Ç —Å—É–º–º—É –¥–æ–∫—É–º–µ–Ω—Ç–∞
  ‚Üí –ø–µ—Ä–µ—Å–æ–∑–¥–∞—ë—Ç—Å—è –ª–∏ JournalEntry?
  ‚Üí –∏–ª–∏ –æ—Å—Ç–∞—ë—Ç—Å—è —Å—Ç–∞—Ä—ã–π?

–ù–∞ —Ç–µ–∫—É—â–∏–π –º–æ–º–µ–Ω—Ç –¥–æ–ø—É—Å—Ç–∏–º —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –≤–∞—Ä–∏–∞–Ω—Ç:

```
–£–¥–∞–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ ‚Üí CASCADE —É–¥–∞–ª—è–µ—Ç JournalEntry
```

–ï—Å–ª–∏ —ç—Ç–æ –Ω–µ —Ç–∞–∫ ‚Äî –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å.

---

## üü† 4. 1 Document = 1 JournalEntry

–ù—É–∂–Ω–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å:

* –Ω–µ–ª—å–∑—è —Å–æ–∑–¥–∞—Ç—å 2 –ø—Ä–æ–≤–æ–¥–∫–∏ –¥–ª—è –æ–¥–Ω–æ–≥–æ documentId
* –Ω–µ–ª—å–∑—è —Å–æ–∑–¥–∞—Ç—å –ø—Ä–æ–≤–æ–¥–∫—É –±–µ–∑ documentId

–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:

–ª–∏–±–æ unique constraint –ª–æ–≥–∏–∫–æ–π
–ª–∏–±–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º.

---

## üü° 5. OSV Integrity

–ü—Ä–æ–≤–µ—Ä—å:

* OSV –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ `JournalLine`
* –ù–µ—Ç —Ä—É—á–Ω—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π –∏–∑ SaleDocument
* Decimal –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç—Å—è –≤ JSON

---

# üî• Acceptance Criteria –¥–ª—è Task 22.1

Claude –¥–æ–ª–∂–µ–Ω –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å:

1. –ë–∞–ª–∞–Ω—Å –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å–µ—Ä–≤–∏—Å–∞
2. –í—Å—ë –≤–Ω—É—Ç—Ä–∏ Prisma transaction
3. Document delete ‚Üí Journal delete (–∏–ª–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è)
4. –ù–µ—Ç ‚Äú–≤–∏—Å—è—á–∏—Ö‚Äù –ø—Ä–æ–≤–æ–¥–æ–∫
5. –û–°–í —Å—á–∏—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ ledger

---

# D=>L (Leanid)

–°–µ–π—á–∞—Å –º—ã –Ω–µ –¥–æ–±–∞–≤–ª—è–µ–º —Ñ–∏—á–∏.

–ú—ã –ø—Ä–æ–≤–µ—Ä—è–µ–º:

* –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å
* —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—É—é —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å
* –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –¥–æ–∫—É–º–µ–Ω—Ç–∞

–ï—Å–ª–∏ —ç—Ç–æ –∂–µ–ª–µ–∑–æ–±–µ—Ç–æ–Ω ‚Äî
—Ç–æ–≥–¥–∞ Solar ERP —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –±—É—Ö–≥–∞–ª—Ç–µ—Ä—Å–∫–∏–º –¥–≤–∏–∂–∫–æ–º.

–ï—Å–ª–∏ –Ω–µ—Ç ‚Äî
–º—ã —Ä–∏—Å–∫—É–µ–º.

---

‚òï
–í—ã—Å—à–∏–π —Ä—É–∫–æ–≤–æ–¥—è—â–∏–π —Å–æ—Å—Ç–∞–≤ –æ–∂–∏–¥–∞–µ—Ç –æ—Ç—á—ë—Ç –æ—Ç Claude –ø–æ 5 –ø—É–Ω–∫—Ç–∞–º.
